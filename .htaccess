# ========================================
# METAL LYRICS GENERATOR - SECURITY
# ========================================

# Block direct access to config.php
<Files "config.php">
    Order Allow,Deny
    Deny from all
</Files>

# Block direct access to .env files (CRITICAL SECURITY!)
<FilesMatch "^\.env">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Block access to disposable codes file
<Files "disposable_codes.json">
    Order Allow,Deny
    Deny from all
</Files>

# Block access to log files
<FilesMatch "\.(log|txt)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Block direct access to CLI scripts
<FilesMatch "^(generate-disposable-codes|generate-password-hash|view-code-statistics)\.php$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# Prevent directory listing
Options -Indexes

# ========================================
# ADVANCED SECURITY HEADERS
# ========================================
<IfModule mod_headers.c>
    # Prevent MIME-type sniffing
    Header always set X-Content-Type-Options "nosniff"

    # Clickjacking protection
    Header always set X-Frame-Options "SAMEORIGIN"

    # XSS protection (legacy, but still useful for older browsers)
    Header always set X-XSS-Protection "1; mode=block"

    # Referrer Policy - only send origin on cross-origin requests
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # Remove X-Powered-By header to hide PHP version
    Header unset X-Powered-By
    Header always unset X-Powered-By

    # Remove Server version information (if possible via headers)
    Header unset Server
    Header always unset Server

    # Content Security Policy (CSP)
    # Restricts resource loading to prevent XSS and data injection attacks
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://api.openai.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https://api.openai.com; frame-ancestors 'self'; base-uri 'self'; form-action 'self';"

    # Permissions Policy (formerly Feature-Policy)
    # Disable unnecessary browser features
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=()"

    # HSTS (HTTP Strict Transport Security)
    # Enforce HTTPS for 1 year (31536000 seconds)
    # WICHTIG: Nur aktivieren wenn HTTPS verf√ºgbar ist!
    # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
</IfModule>
